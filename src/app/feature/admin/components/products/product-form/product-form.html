<h2 class="text-lg font-semibold text-gray-300 pb-4 text-center">
  {{ productForm.get('id')?.value ? 'Actualizar' : 'Agregar' }} producto
</h2>

<form [formGroup]="productForm" (submit)="onSubmit($event)" class="space-y-4 text-gray-300">
  <!-- Nombre del Producto -->
  <div>
    <label for="name" class="block text-sm font-medium">Nombre del producto</label>
    <input
      id="name"
      type="text"
      formControlName="name"
      class="border border-gray-300 rounded w-full p-2"
      [class.border-red-300]="isFieldInvalid('name')"
    />
    @if (isFieldInvalid('name')) { @if (f['name'].errors?.['required']) {
    <p class="text-red-500 text-xs mt-1">El nombre es requerido</p>
    } @if (f['name'].errors?.['minlength']) {
    <p class="text-red-500 text-xs mt-1">El nombre debe tener al menos 3 caracteres</p>
    } }
  </div>

  <div class="flex gap-2">
    <input type="checkbox" formControlName="status" class="w-4 h-4" />
    <label for="status" class="block text-sm font-medium">Activo</label>
  </div>

  <!-- Precio -->
  <div>
    <label for="price" class="block text-sm font-medium">Precio</label>
    <input
      id="price"
      type="number"
      min="0.01"
      step="0.01"
      formControlName="price"
      class="border border-gray-300 rounded w-full p-2"
      [class.border-red-300]="isFieldInvalid('price')"
    />
    @if (isFieldInvalid('price')) { @if (f['price'].errors?.['required']) {
    <p class="text-red-500 text-xs mt-1">El precio es requerido</p>
    } @if (f['price'].errors?.['min']) {
    <p class="text-red-500 text-xs mt-1">El precio debe ser mayor a 0</p>
    } }
  </div>

  <!-- Descripción -->
  <div>
    <label for="description" class="block text-sm font-medium">Descripción</label>
    <textarea
      id="description"
      formControlName="description"
      rows="3"
      class="border border-gray-300 rounded w-full p-2"
      [class.border-red-300]="isFieldInvalid('description')"
    ></textarea>
    @if (isFieldInvalid('description')) { @if (f['description'].errors?.['required']) {
    <p class="text-red-500 text-xs mt-1">La descripción es requerida</p>
    } @if (f['description'].errors?.['minlength']) {
    <p class="text-red-500 text-xs mt-1">La descripción debe tener al menos 10 caracteres</p>
    } }
  </div>

  <!-- Stock -->
  <div>
    <label for="stock" class="block text-sm font-medium">Stock</label>
    <input
      id="stock"
      type="number"
      min="0"
      (wheel)="$event.target.blur()"
      formControlName="stock"
      class="border border-gray-300 rounded w-full p-2"
      [class.border-red-300]="isFieldInvalid('stock')"
    />
    @if (isFieldInvalid('stock')) { @if (f['stock'].errors?.['required']) {
    <p class="text-red-500 text-xs mt-1">El stock es requerido</p>
    } @if (f['stock'].errors?.['min']) {
    <p class="text-red-500 text-xs mt-1">El stock no puede ser negativo</p>
    } }
  </div>

  <!-- Categoría -->
  <div>
    <label for="category" class="block text-sm font-medium">Categoría</label>
    <select
      id="category"
      formControlName="category"
      class="border border-gray-300 rounded w-full p-2"
      [class.border-red-300]="isFieldInvalid('category')"
    >
      <option class="bg-gray-800" [ngValue]="''">Seleccionar categoría</option>
      @for (cat of categories(); track cat.id) {
      <option class="bg-gray-900" [value]="cat.id">{{ cat.name }}</option>
      }
    </select>
    @if (isFieldInvalid('category')) {
    <p class="text-red-500 text-xs mt-1">La categoría es requerida</p>
    }
  </div>

  <!-- Image Upload -->
  <div class="space-y-2">
    <label class="block text-sm font-medium">Imagen del producto</label>

    <!-- Image preview -->
    @if (previewUrl || productForm.get('image')?.value) {
    <div class="mb-3">
      <div class="relative inline-block">
        <img
          [src]="previewUrl || productForm.get('image')?.value"
          alt="Preview"
          class="h-32 w-32 object-cover rounded border border-gray-300"
        />
        <button
          type="button"
          (click)="removeImage()"
          class="absolute -top-2 -right-2 bg-blue-600 text-white rounded-full p-1 hover:bg-blue-700 transition-colors"
          title="Eliminar imagen"
        >
          <lucide-angular [name]="removeIcon" [size]="18"></lucide-angular>
        </button>
      </div>
    </div>
    }

    <!-- File input -->
    <div class="flex items-center">
      <input
        type="file"
        #fileInput
        (change)="onFileSelected($event)"
        accept="image/*"
        class="hidden"
        id="imageUpload"
      />
      <label
        for="imageUpload"
        class="cursor-pointer bg-gray-900 py-2 px-3 rounded-lg shadow-sm text-sm leading-4 font-medium text-gray-200 focus:outline-none"
      >
        <span>Seleccionar archivo</span>
      </label>
      @if (selectedFile) {
      <span class="ml-3 text-sm text-gray-500">{{ selectedFile.name }}</span>
      }
    </div>

    <!-- Hidden input for image URL -->
    <input type="hidden" formControlName="image" />

    <p class="text-xs text-gray-600 mt-1">
      Sube una imagen del producto o proporciona una URL. Tamaño máximo: 5MB. Formatos: JPG, PNG,
      WebP.
    </p>
  </div>

  <!-- Botones -->
  <menu class="flex justify-end gap-2 mt-6">
    <button
      type="button"
      class="text-gray-400 bg-gray-900 px-4 py-2 rounded-lg hover:bg-gray-950 transition-colors"
      (click)="closeModal()"
    >
      Cancelar
    </button>

    <button
      type="submit"
      class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
      [disabled]="!productForm.valid"
    >
      {{ productForm.get('id')?.value ? 'Actualizar' : 'Agregar' }}
    </button>
  </menu>
</form>
