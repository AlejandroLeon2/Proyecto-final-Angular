<div class="bg-[var(--bg-main)] min-h-screen py-12">
  <div class="max-w-5xl mx-auto px-6">
    <!-- Botón volver -->
    <button
      (click)="goBack()"
      class="mb-6 text-[var(--text-muted)] hover:text-[var(--text-main)] font-medium flex items-center gap-2 transition"
    >
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
      </svg>
      Volver
    </button>

    <!-- Estado de carga -->
    @if (isLoading) {
    <div class="flex justify-center items-center h-96">
      <div class="w-8 h-8 border-2 border-[var(--text-soft)] border-t-[var(--primary)] rounded-full animate-spin"></div>
    </div>
    }

    <!-- Error -->
    @if (error) {
    <div class="border border-[var(--error)] p-4 rounded">
      <p class="text-[var(--error)] text-sm">{{ error }}</p>
    </div>
    }

    <!-- Contenido principal -->
    @if (product && !isLoading) {
    <div class="grid md:grid-cols-2 gap-16">
      
      <!-- Imagen -->
      <div class="flex items-center justify-center">
        <img
          [src]="product.image"
          [alt]="product.name"
          class="w-full max-h-100 max-w-md object-contain"
        />
      </div>

      <!-- Info -->
      <div class="space-y-8">
        
        <!-- Header -->
        <div class="space-y-4">
          <span class="text-xs uppercase tracking-wider text-[var(--text-soft)] font-medium">
            {{ product.category }}
          </span>
          
          <h1 class="text-3xl font-light text-[var(--text-main)]">
            {{ product.name }}
          </h1>
          
          <p class="text-[var(--text-muted)] leading-relaxed">
            {{ product.description }}
          </p>
        </div>

        <!-- Precio -->
        <div class="pt-6 border-t border-[var(--border)]">
          <p class="text-2xl font-light text-[var(--text-main)]">
            {{ product.price  | currency: 'PEN':'symbol':'1.2' }}
          </p>
        </div>

        <!-- Stock -->
        <div>
          <p class="text-sm text-[var(--text-muted)]">
            @if (isOutOfStock()) {
              Sin stock
            } @else if (isLowStock()) {
              {{ product.stock }} unidades disponibles
            } @else {
              En stock <span class="font-light ">{{product.stock}}</span>
            }
          </p>
        </div>

        <!-- Cantidad -->
        <div class="space-y-3">
          <label class="text-sm text-[var(--text-muted)]">Cantidad</label>
          
          <div class="flex items-center gap-4">
            <div class="flex items-center border border-[var(--border)] rounded">
              <button
                (click)="decreaseQuantity()"
                [disabled]="quantity <= 1 || isOutOfStock()"
                class="w-10 h-10 border-r border-[var(--border)]  flex justify-center items-center text-[var(--text-main)] disabled:opacity-30 disabled:cursor-not-allowed hover:bg-[var(--bg-alt)] transition"
              >
                <lucide-icon [img]="Minus" size="16"></lucide-icon>
              </button>

              <span class="w-12 text-center text-[var(--text-main)] text-sm">
                {{ quantity }}
              </span>

              <button
                (click)="increaseQuantity()"
                [disabled]="quantity >= product.stock || isOutOfStock()"
                class="w-10 border-l border-[var(--border)]  flex justify-center items-center h-10 text-[var(--text-main)] disabled:opacity-30 disabled:cursor-not-allowed hover:bg-[var(--bg-alt)] transition"
              >
                <lucide-icon [img]="Plus" size="16"></lucide-icon>
              </button>
            </div>

            <button
              (click)="addToCart()"
              [disabled]="isOutOfStock()"
              class="flex gap-4 justify-center items-center px-4 w-full h-10 bg-[var(--text-main)] text-[var(--bg-card)] disabled:opacity-30 disabled:cursor-not-allowed hover:opacity-90 transition text-sm font-medium"
            >
              Agregar al carrito <lucide-icon [img]="shoppingCartIcon" size="16"></lucide-icon>
            </button>
          </div>
        </div>

        <!-- Total -->
        <div class="pt-6 border-t border-[var(--border)]">
          <div class="flex justify-between items-center">
            <span class="text-sm text-[var(--text-muted)]">Total</span>
            <span class="text-xl font-light text-[var(--text-main)]">
               {{ product.price * quantity | currency: 'PEN':'symbol':'1.2' }}
            </span>
          </div>
        </div>

      </div>
    </div>
    }
  </div>
    <section id="tecnologia" class="relative mt-12 max-w-7xl mx-auto px-4">
    <div class="flex justify-between items-center mb-8">
      <h2 class="text-2xl md:text-3xl font-bold text-[var(--text-main)]">Recomendados</h2>
      <a
        [routerLink]="['/shop/catalogo-product']"
        class="text-[var(--text-main)] hover:text-blue-700 font-semibold"
      >
        Ver todos →
      </a>
    </div>

    @defer (on viewport) {
    <app-product-carousel
      [products]="featuredProducts()"
      [itemsPerView]="4"
      [autoPlay]="true"
      [autoPlayInterval]="4000"
    >
    </app-product-carousel>
    } @placeholder {
    <!-- Se muestra mientras no entra al viewport -->
    <div class="h-40 flex items-center justify-center text-gray-400">
      Carrusel pendiente de carga…
    </div>
    } @loading {
    <!-- Se muestra mientras se carga el módulo -->
    <div class="flex justify-center items-center min-h-[20svh]">
      <div
        class="animate-spin rounded-full h-8 w-8 border-b-2 border-[var(--border-loading)]"
      ></div>
    </div>
    }
      @if (featuredProducts().length === 0) {
  <div class="text-center py-12">
    <p class="text-gray-500 text-lg">No hay productos disponibles</p>
  </div>
  }
  </section>
</div>